# =============================================================================
# OPEN SOUSVEILLANCE STUDIO - INSTANCE CONFIGURATION
# =============================================================================
# This file defines YOUR specific deployment of Open Sousveillance Studio.
# Customize this for your community, city, county, or state.
#
# CONFIGURATION FILES:
#   instance.yaml       - This file: deployment settings, scheduling, alerts
#   entities.yaml       - Watchlist: entities, keywords, topics to FLAG
#   sources.yaml        - Data sources: URLs, portals, document feeds
#   civic_categories.yaml - Universal civic categories (shared across instances)
#
# To deploy for a new municipality:
# 1. Copy this file and entities.yaml
# 2. Update jurisdiction and watchlist for your area
# 3. Configure sources.yaml with local government URLs
# 4. civic_categories.yaml is universal - no changes needed
# =============================================================================

# -----------------------------------------------------------------------------
# INSTANCE IDENTITY
# -----------------------------------------------------------------------------
instance:
  # Unique identifier for this instance (used in database, logs, etc.)
  id: "alachua-fl"

  # Human-readable name for reports and dashboards
  name: "Alachua County Civic Watch"

  # Short description of the monitoring focus
  description: "Monitoring local government transparency in Alachua County, Florida, with a focus on protecting the Floridan Aquifer and Mill Creek Sink."

  # Timezone for scheduling and timestamps (IANA format)
  timezone: "America/New_York"

  # Contact info for the instance operator (for attribution in reports)
  operator:
    name: "Our Alachua Water Coalition"
    email: "contact@ouralachuawater.org"
    website: "https://ouralachuawater.org"

# -----------------------------------------------------------------------------
# JURISDICTION HIERARCHY
# -----------------------------------------------------------------------------
# Define the geographic scope of monitoring. This helps agents understand
# which sources are relevant and how to prioritize overlapping jurisdictions.

jurisdiction:
  # Country (ISO 3166-1 alpha-2)
  country: "US"

  # State (US postal code or full name)
  state: "FL"
  state_name: "Florida"

  # County (primary geographic unit)
  county: "Alachua"
  county_fips: "12001"  # Optional: FIPS code for data integration

  # Municipalities within scope (list all cities/towns to monitor)
  municipalities:
    - name: "City of Alachua"
      type: "city"
      population: 10000  # Approximate, for context
      primary: true  # This is the main focus
    - name: "City of High Springs"
      type: "city"
      population: 6000
      primary: false
    - name: "City of Gainesville"
      type: "city"
      population: 145000
      primary: false

  # Unincorporated areas (if monitoring county-level only)
  include_unincorporated: true

# -----------------------------------------------------------------------------
# SCHEDULING CONFIGURATION
# -----------------------------------------------------------------------------
# Define when agents run. Uses cron syntax.
# Format: "minute hour day-of-month month day-of-week"

schedule:
  # Daily scouts - check for new documents
  scouts:
    enabled: true
    cron: "0 6 * * *"  # Every day at 6:00 AM
    retry_on_failure: true
    max_retries: 3

  # Weekly analysts - synthesize patterns
  analysts:
    enabled: true
    cron: "0 9 * * 1"  # Every Monday at 9:00 AM
    requires_approval: true  # Pause for human review before synthesis

  # Monthly synthesizers - generate newsletters
  synthesizers:
    enabled: true
    cron: "0 10 1 * *"  # First day of month at 10:00 AM
    requires_approval: true

# -----------------------------------------------------------------------------
# ALERT CONFIGURATION
# -----------------------------------------------------------------------------
# Define how and when to send alerts for high-priority findings.

alerts:
  # Enable/disable alert system
  enabled: true

  # Channels for different urgency levels
  channels:
    red:  # Immediate action required
      - type: "discord"
        webhook_url: "${DISCORD_WEBHOOK_URL}"  # Use env var
      - type: "email"
        recipients: ["alerts@ouralachuawater.org"]

    yellow:  # Monitor closely
      - type: "email"
        recipients: ["weekly-digest@ouralachuawater.org"]

    green:  # Informational
      - type: "log"  # Just log to database, no notification

# -----------------------------------------------------------------------------
# OUTPUT CONFIGURATION
# -----------------------------------------------------------------------------
# Where and how to publish generated content.

outputs:
  # Local file storage
  local:
    enabled: true
    base_path: "./data"
    structure: "frequency"  # Options: "frequency" (daily/weekly/monthly), "date" (YYYY/MM/DD)

  # Supabase storage (for PDFs and documents)
  supabase_storage:
    enabled: true
    bucket: "government-documents"

  # Newsletter distribution
  newsletter:
    enabled: false  # Enable when ready
    provider: "resend"  # Options: "resend", "sendgrid", "mailchimp"
    from_name: "Alachua Civic Watch"
    from_email: "newsletter@ouralachuawater.org"
    reply_to: "contact@ouralachuawater.org"

# -----------------------------------------------------------------------------
# FEATURE FLAGS
# -----------------------------------------------------------------------------
# Enable or disable specific features for your instance.

features:
  # PDF processing
  pdf_extraction:
    enabled: true
    method: "hybrid"  # Options: "pdfplumber", "gemini", "hybrid"
    store_originals: true  # Keep original PDFs in storage

  # Vector embeddings for semantic search
  embeddings:
    enabled: true
    model: "text-embedding-004"  # Google's embedding model
    store_in: "supabase"  # Uses pgvector

  # Human-in-the-loop approval
  approval_workflow:
    enabled: true
    require_for: ["analyst", "synthesizer"]  # Which agent types need approval

  # Change detection (vs full scrape every time)
  change_detection:
    enabled: true
    method: "hash"  # Options: "hash", "visual", "dom"
